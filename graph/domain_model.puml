@startuml parkinglot
skinparam Shadowing false
skinparam class {
    BackgroundColor PaleTurquoise 
    ArrowColor SeaGreen
}

package parkingcontext <<Core SubDomain>> {
    package parking {
        interface FindParkingLotService {
            ParkingLot findParkingLot(ParkingLotFinderSpecification)
        }
        interface ParkingLotFinderSpecification {
            ParkingLotFinder newParkingLotFinder()
        }
        interface ParkingLotFinder {
            ParkingLot findParkingLotToPark()
        }
        class ParkingLot <<Entity>> <<Aggregate>> {
            -ParkingLotId id
            -Map<TicketId, Car> ticketToCarMap
            --
            +Ticket park(Car car)
            +Car pick(TicketId ticketId)
        }
        class Ticket <<Value Object>> {
            -String licensePlate
            -ParkingLotId parkingLotId
        }
        class Car <<Value Object>> {
            -String licensePlate
        }
        FindParkingLotService .down.> ParkingLotFinderSpecification
        ParkingLot "1" *-down-> "many" Ticket
        ParkingLot "1" -right-> "many" Car
        ParkingLot --left[hidden] Car
    }

    package finder {
        class ParkingManagerSpecification {
            +ParkingLotFinder newParkingLotFinder()
        }
        class ParkingBoySpecification {
            -ParkingBoyId parkingBoyConfigId
            --
            +ParkingLotFinder newParkingLotFinder()
        }
        class ParkingBoy <<Value Object>> {
            -String name
            -List<ParkingLot> parkingLots
            -ParkingPolicy parkingPolicy
            --
            +Optional<ParkingLot> find()
        }
        class ParkingManager <<Value Object>> {
            -String name
            -List<ParkingBoy> parkingBoys
            --
            +List<ParkingLot> listParkingLotIds()
            +Optional<ParkingLot> findParkingLot()
        }
        interface ParkingPolicy {
            +ParkingLot findParkingLotToPark(Collection<ParkingLot> parkingLots)
        }
        ParkingManagerSpecification -up-|> ParkingLotFinderSpecification
        ParkingBoySpecification -up-|> ParkingLotFinderSpecification
        ParkingManager -up-|> ParkingLotFinder
        ParkingBoy -up-|> ParkingLotFinder
        ParkingManager *-left-> ParkingBoy
        ParkingBoy *--> ParkingPolicy
    }

    package policy {
        class SeniorParkingPolicy <<Value Object>> {
            +ParkingLot findParkingLotToPark(Collection<ParkingLot> parkingLots)
        }
        class JuniorParkingPolicy <<Value Object>> {
            +ParkingLot findParkingLotToPark(Collection<ParkingLot> parkingLots)
        }
        SeniorParkingPolicy -up-|> ParkingPolicy
        JuniorParkingPolicy -up-|> ParkingPolicy
    }
}

namespace configcontext <<Support SubDomain>> {
  class ParkingManagerConfig <<Entity>> <<Aggregate Root>> {
     ParkingManagerConfigId id
     List<ParkingBoyConfigId> parkingBoyIds
  }
  class ParkingBoyConfig <<Entity>> <<Aggregate Root>> {
    ParkingBoyConfigId id
    List<ParkingLotId> parkingLotIds
    ParkingPolicyName name
  }
  enum ParkingPolicyEnum <<Value Object>>
  ParkingBoyConfig --> ParkingPolicyEnum
  ParkingManagerConfig --[hidden] ParkingBoyConfig
}

@enduml